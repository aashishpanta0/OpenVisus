version: '1.0.{build}'

notifications:
  - provider: Email
    to:
      - scrgiorgio@gmail.com
    on_build_success: true
    on_build_failure: true
    on_build_status_changed: true  
   
environment:
  QT5_DIR: C:/Qt/5.11.2/msvc2017_64/lib/cmake/Qt5
  APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
  CMAKE_GENERATOR: Visual Studio 15 2017 Win64
  PYPI_USERNAME: scrgiorgio
  PYPI_PASSWORD:
    secure: 6DHH80JPNRCtIYxWc/h88Q==   
  matrix:
    - PYTHON_EXECUTABLE: C:/Python37-x64/python.exe 
      PYTHON_VERSION: 37
      DEFAULT_ENABLED: true  
    - PYTHON_EXECUTABLE: C:/Python36-x64/python.exe 
      PYTHON_VERSION: 36
      DEFAULT_ENABLED: true
    - PYTHON_EXECUTABLE: C:/Python27-x64/python.exe 
      PYTHON_VERSION: 27
      DEFAULT_ENABLED: true      
  
# enable cache for vcpkg
cache: c:\tools\vcpkg\installed\  
  
# 
#if you need to debug uncomment these lines (see https://www.appveyor.com/docs/how-to/rdp-to-build-worker/)
#init:
#  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
#
#on_finish:
#  - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))


init:
  - ps: | 
      If ($env:APPVEYOR_REPO_TAG -eq "false" -and $env:DEFAULT_ENABLED -eq "false") {
        Write-Host "Skipping build"
        Exit-AppveyorBuild
      }   

build_script:
  - cmd: choco install -y --allow-empty-checksums swig 
  - cmd: cd %APPVEYOR_BUILD_FOLDER% 
  - cmd: .\build.bat 
  - cmd: echo [distutils]                                 > %USERPROFILE%\\.pypirc
  - cmd: echo index-servers =                            >> %USERPROFILE%\\.pypirc
  - cmd: echo     pypi                                   >> %USERPROFILE%\\.pypirc
  - cmd: echo [pypi]                                     >> %USERPROFILE%\\.pypirc
  - cmd: echo username = %PYPI_USERNAME%                 >> %USERPROFILE%\\.pypirc
  - cmd: echo password = %PYPI_PASSWORD%                 >> %USERPROFILE%\\.pypirc
  - cmd: set HOME=%USERPROFILE%
  - cmd: if "%APPVEYOR_REPO_TAG%" == "true" ( %PYTHON_EXECUTABLE% -m pip install --user --upgrade twine )
  - cmd: if "%APPVEYOR_REPO_TAG%" == "true" ( %PYTHON_EXECUTABLE% -m twine upload --skip-existing "%APPVEYOR_BUILD_FOLDER%/build/install/dist/*.whl" ) 

test: off

artifacts:
    - path: build\install\dist\*.zip
      name: GitHubReleasesArtifact
 
deploy:
  - provider: GitHub
    auth_token:
      secure: nwK8bGTRUynj+58b7E8Rgur5/0YvfIivBflFb5AaUrpC5BSTpcLbA4Ac+cCF6L4/
    artifact: GitHubReleasesArtifact
    on:
      appveyor_repo_tag: true


